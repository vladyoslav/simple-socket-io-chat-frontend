import{a as g,u as M,b as h,c as f,o as p,l as K,d as v,r as i,e as d,R as e,P as S,f as A,G as U,F as W,g as _,I as G,B as x,h as F,V as B,i as H,W as z,j as T,M as j,k as $,q,S as J,m as Q,n as X,A as Y,p as Z,s as C,t as ee,v as te,x as ne,w as se,y as ae,$ as ue,z as L,C as re,D as oe,E as ce,H as le,J as ie,K as me,L as k,N as de,O as Ee,Q as ge}from"./vendor.f1f7cc57.js";const he=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function u(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}};he();const pe=g({},"vkUser"),R=g(void 0,"snackbar"),N=g([],"messages");g("","connectionError");const I=g("","nickname");var y;(function(n){n[n.DONE=0]="DONE",n[n.ERROR=1]="ERROR"})(y||(y={}));R.set;const fe="https://simple-socket-io-chat.gachi-team.ru/";class O{constructor({trigger:t,handler:s}){this.trigger=t,this.handler=s}}const ve=new O({trigger:"new_message",handler:n=>{M(N)(s=>[...s,n])}}),Ae=new O({trigger:"connect",handler:()=>{h(),f("/chat"),p(),console.log("connected")}}),Ce=[ve,Ae];class ke{emit(t,...s){return new Promise(u=>{var a;return(a=this.socket)==null?void 0:a.emit(t,...s,u)})}connect(t){this.socket=K(fe,{query:t}),Ce.forEach(s=>{var u;return(u=this.socket)==null?void 0:u.on(s.trigger,s.handler)})}sendMessage(t){return this.emit("new_message",t)}getMessages(){return this.emit("get_messages")}}const E=new ke,ye=({nav:n})=>{const[t,s]=v(I),[u,a]=i.exports.useState(""),r=l=>{s(l.target.value)},c=l=>{l.preventDefault(),!!t&&(f("/?popout=loading"),p(),E.connect({nickname:t}))};return i.exports.useEffect(()=>{var l;return(l=E.socket)==null||l.on("connect_error",m=>{h(),d(),a(m.message)}),()=>{var m;(m=E.socket)==null||m.removeListener("connect_error")}},[E.socket]),e.createElement(S,{nav:n},e.createElement(A,null,"\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F"),e.createElement(U,null,e.createElement(W,{onSubmit:c},e.createElement(_,{top:"\u041D\u0438\u043A\u043D\u0435\u0439\u043C",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0438\u043A\u043D\u0435\u0439\u043C",status:u?"error":"default",bottom:u},e.createElement(G,{value:t,onChange:r})),e.createElement(_,null,e.createElement(x,{type:"submit",size:"l",stretched:!0,disabled:t.length===0},"\u0414\u0430\u043B\u0435\u0435")))))};const we=({mine:n=!1,nickname:t,text:s})=>e.createElement("div",{className:"Message"+(n?" Message--mine":"")},e.createElement("div",{className:"Message__nickname"},t),e.createElement("div",{className:"Message__text"},s)),be=({nav:n})=>{var b;const[t,s]=i.exports.useState(""),u=i.exports.useRef(null),[a,r]=v(N),{viewWidth:c}=F(),l=(c!=null?c:0)>=B.SMALL_TABLET,m=H(I),P=o=>{s(o.target.value)},V=o=>{o.key=="Enter"&&!o.shiftKey&&(o.preventDefault(),w())},w=()=>{console.log(t),E.sendMessage(t),s("")};return i.exports.useEffect(()=>{(async()=>{await h(),await f("/chat?popout=loading"),await p();const D=await E.getMessages();r(D),console.log(D),await h(),await d(),await p()})()},[]),e.createElement(S,{nav:n,className:"ChatPanel"},e.createElement(A,{fixed:!0},"\u0427\u0430\u0442"),e.createElement("div",{className:"Chat"},e.createElement("div",{className:"Chat__ChatBox"},a.map(o=>e.createElement(we,{key:o.id,mine:o.nickname===m,nickname:o.nickname,text:o.text}))),e.createElement("div",{style:{height:(b=u.current)==null?void 0:b.clientHeight}}),e.createElement(z,{className:"Chat__WriteBar",placeholder:"\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435",value:t,onChange:P,onKeyPress:V,getRootRef:u,style:{width:l?"550px":"100%"},after:e.createElement(T,{type:"submit",mode:"send",disabled:t.length===0,onClick:w})})))},De=({nav:n})=>e.createElement(j,{nav:n,onClose:d,icon:e.createElement($,null),header:"\u042D\u0442\u043E \u043C\u043E\u0434\u0430\u043B\u044C\u043D\u0430\u044F \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0430",subheader:"\u042D\u0442\u043E \u0442\u0435\u043A\u0441\u0442 \u043C\u043E\u0434\u0430\u043B\u044C\u043D\u043E\u0439 \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438",actions:e.createElement(x,{size:"l",mode:"primary",onClick:d},"\u041F\u043E\u043D\u044F\u0442\u043D\u043E")}),Me=()=>e.createElement(q,null,e.createElement(De,{nav:"modal"})),Se=({isDesktop:n})=>{const[t,s]=v(R);return t?e.createElement(J,{onClose:()=>s(void 0),before:(t==null?void 0:t.type)===y.DONE?e.createElement(Q,{width:24,height:24}):e.createElement(X,{width:24,height:24}),style:n?{}:{marginBottom:"calc(var(--tabbar_height) + var(--safe-area-inset-bottom))"}},t==null?void 0:t.text):e.createElement(e.Fragment,null)},_e=()=>e.createElement(Y,{actions:[{title:"\u041A\u0440\u0443\u0442\u043E!",mode:"destructive",autoclose:!0},{title:"\u041E\u0442\u043C\u0435\u043D\u0430",mode:"cancel",autoclose:!0}],onClose:d,header:"\u0422\u0435\u0441\u0442\u043E\u0432\u044B\u0439 \u0430\u043B\u0435\u0440\u0442",text:"\u042D\u0442\u043E \u0442\u0435\u0441\u0442\u043E\u0432\u044B\u0439 \u0430\u043B\u0435\u0440\u0442!",actionsLayout:"vertical"}),xe=()=>{const n=i.exports.useRef(document.getElementById("ShowAlert"));return e.createElement(Z,{onClose:d,iosCloseItem:e.createElement(C,{autoclose:!0,mode:"cancel"},"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C"),toggleRef:n},e.createElement(C,{autoclose:!0},"\u042D\u0442\u043E \u043F\u0435\u0440\u0432\u0430\u044F \u043E\u043F\u0446\u0438\u044F"),e.createElement(C,{autoclose:!0},"\u042D\u0442\u043E \u0432\u0442\u043E\u0440\u0430\u044F \u043E\u043F\u0446\u0438\u044F"))},Fe=()=>e.createElement(ee,null),Be=()=>e.createElement(te,null,e.createElement(_e,{nav:"alert"}),e.createElement(xe,{nav:"action-sheet"}),e.createElement(Fe,{nav:"loading"})),Le=({children:n})=>{const{viewWidth:t}=F(),s=(t!=null?t:0)>=B.SMALL_TABLET;return e.createElement(ne,null,e.createElement(se,{header:!s&&e.createElement(A,{separator:!1}),style:{justifyContent:"center"},modal:e.createElement(Me,null),popout:e.createElement(Be,null)},e.createElement(ae,{animate:!s,width:s?"550px":"100%",maxWidth:s?"550px":"100%"},e.createElement(ue,null,n),e.createElement(Se,{isDesktop:s}))))},Re=n=>new URLSearchParams(window.location.search).get(n),Ne={iphone:L,mobile_web:L,android:re,desktop_web:oe},Ie=()=>{const n=Re("vk_platform");return Ne[n||"desktop_web"]},Oe=()=>{const n=Ie(),t=M(pe);return i.exports.useEffect(()=>{(async()=>{const u=await k.send("VKWebAppGetUserInfo");t(u)})()},[]),e.createElement(ce,{platform:n},e.createElement(le,null,e.createElement(ie,null,e.createElement(Le,null,e.createElement(me,{nav:"/"},e.createElement(ye,{nav:"/"}),e.createElement(be,{nav:"/chat"}))))))};k.subscribe(n=>{if(n.detail.type==="VKWebAppUpdateConfig"){const t=n.detail.data.scheme||"client_light";document.body.setAttribute("scheme",t)}});k.send("VKWebAppInit").then();de();Ee.render(e.createElement(ge,null,e.createElement(Oe,null)),document.getElementById("root"));
